datasource db {
  provider = "postgresql"
  url      = env("PG_CONNECTION_STRING")
}

generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "debian-openssl-1.1.x"]
}

// ////////////////////////////////////////////////////////////////////////////
//
// APPLICATION CONFIGURATION
//
// ////////////////////////////////////////////////////////////////////////////

model App {
  id              String        @id @default(uuid())
  createdAt       DateTime      @default(now())
  name            String
  env             String
  instance        String
  sentryConfig    SentryConfig? @relation(fields: [sentryConfigId], references: [id], onDelete: Cascade)
  sentryConfigId  String?
  expressConfig   ExpressConfig @relation(fields: [expressConfigId], references: [id], onDelete: Cascade)
  expressConfigId String
  loggerConfig    LoggerConfig  @relation(fields: [loggerConfigId], references: [id], onDelete: Cascade)
  loggerConfigId  String
  xmtpConfig      XmtpConfig    @relation(fields: [xmtpConfigId], references: [id], onDelete: Cascade)
  xmtpConfigId    String
  httpConfig      HttpConfig    @relation(fields: [httpConfigId], references: [id], onDelete: Cascade)
  httpConfigId    String

  @@unique([name, env, instance])
}

model SentryConfig {
  id          String   @id @default(uuid())
  createdAt   DateTime @default(now())
  dsn         String
  release     String
  serverName  String
  environment String
  apps        App[]
}

model ExpressConfig {
  id        String   @id @default(uuid())
  createdAt DateTime @default(now())
  port      Int
  apps      App[]
}

model LoggerConfig {
  id        String   @id @default(uuid())
  createdAt DateTime @default(now())
  level     String
  apps      App[]
}

model XmtpConfig {
  id             String   @id @default(uuid())
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
  bridgeAddress  String   @unique
  bridgeBootKey  String
  webhookAddress String
  apps           App[]
}

model HttpConfig {
  id        String   @id @default(uuid())
  createdAt DateTime @default(now())
  httpUrl   String
  isBot     Boolean
  apps      App[]
}
